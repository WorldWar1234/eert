import g from"sharp";import{redirect as l}from"./rrd.js";export async function compressImg(t,e,r){const{t:i,i:o,o:a,p:n}=t.params;const s=i?"webp":"jpeg";try{let t=g(r).i(o).toFormat(s,{o:a,m:true,g:i,l:i?"4:4:4":"4:2:0"});const{data:p,info:m}=await t.toBuffer({u:true});e.header("content-type",`image/${s}`).header("content-length",m.size).header("x-original-size",n).header("x-bytes-saved",n-m.size).code(200).send(p)}catch(c){return l(t,e)}}
